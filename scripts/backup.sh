#!/bin/bash

# –°–∫—Ä–∏–ø—Ç —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –í–µ—Ä–µ—Å-–¢–∞—Ä–∏—Ñ

echo "üíæ –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ –í–µ—Ä–µ—Å-–¢–∞—Ä–∏—Ñ"
echo "======================================="

# –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –±—ç–∫–∞–ø–æ–≤
BACKUP_DIR="backups"
mkdir -p $BACKUP_DIR

# –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏–º—è —Ñ–∞–π–ª–∞ —Å –¥–∞—Ç–æ–π
BACKUP_FILE="veres-backup-$(date +%Y%m%d-%H%M%S).tar.gz"

echo "üì¶ –°–æ–∑–¥–∞–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞..."

# –°–æ–∑–¥–∞–µ–º –∞—Ä—Ö–∏–≤ —Å –¥–∞–Ω–Ω—ã–º–∏
tar -czf "$BACKUP_DIR/$BACKUP_FILE" \
    data/ \
    uploaded_files/ \
    generated_docs/ \
    docker-compose.yml \
    docker-compose.prod.yml

echo "‚úÖ –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Å–æ–∑–¥–∞–Ω–∞: $BACKUP_DIR/$BACKUP_FILE"

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –∞—Ä—Ö–∏–≤–∞
ARCHIVE_SIZE=$(du -h "$BACKUP_DIR/$BACKUP_FILE" | cut -f1)
echo "üìä –†–∞–∑–º–µ—Ä –∞—Ä—Ö–∏–≤–∞: $ARCHIVE_SIZE"

echo ""
echo "üîÑ –î–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏:"
echo "   1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã: docker-compose down"
echo "   2. –†–∞—Å–ø–∞–∫—É–π—Ç–µ –∞—Ä—Ö–∏–≤: tar -xzf $BACKUP_DIR/$BACKUP_FILE"
echo "   3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã: docker-compose up -d"
